<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Attendance Engine</title>

<style>
body {
  background:#0f172a;
  color:white;
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  padding:30px;
}
input,select,button{
  padding:10px;
  margin:5px 0;
  border-radius:8px;
  border:none;
}
button{background:#6366f1;color:white;cursor:pointer;}
pre{background:#1e293b;padding:15px;border-radius:10px;}
</style>
</head>

<body>

<h2>Phase 1 Engine</h2>

<select id="subject">
  <option value="ds">Data Structures</option>
  <option value="python">Python</option>
  <option value="la">Linear Algebra</option>
  <option value="dtw">Design Tools</option>
  <option value="coa">COA</option>
  <option value="iot">IoT</option>
  <option value="comm">Communication</option>
</select>

<br>
<label>Select Date:</label>
<input type="date" id="selectedDate">

<br>
<button onclick="runEngine()">Run Engine</button>

<pre id="output"></pre>

<script>

const semesterStart = new Date("2025-12-22");
const semesterEnd = new Date("2026-04-18");

// Holidays (yyyy-mm-dd)
const holidays = [
  "2026-01-12","2026-01-13","2026-01-14",
  "2026-01-15","2026-01-16","2026-01-17",
  "2026-03-19","2026-03-21",
  "2026-03-27","2026-04-14"
];

function isHoliday(date){
  return holidays.includes(date.toISOString().split("T")[0]);
}

// Weekday timetable mapping
function getClassesForDay(day){
  switch(day){
    case 1: return { ds:{S:2}, python:{L:2}, comm:{P:2} }; // Monday
    case 2: return { ds:{S:2}, comm:{P:2} }; // Tuesday
    case 3: return { iot:{L:2}, ds:{L:2}, dtw:{P:2} }; // Wednesday
    case 4: return { iot:{P:2}, la:{S:2}, dtw:{P:2} }; // Thursday
    case 5: return { la:{T:2}, ds:{P:2}, coa:{L:2} }; // Friday
    case 6: return { coa:{L:1}, python:{P:2}, ds:{L:1} }; // Saturday
    default: return {}; // Sunday
  }
}

function countClasses(untilDate){

  let counts = {};

  let current = new Date(semesterStart);

  while(current <= untilDate){

    if(current.getDay() !== 0 && !isHoliday(current)){

      let dayMap = getClassesForDay(current.getDay());

      for(let subject in dayMap){

        if(!counts[subject]) counts[subject] = {};

        for(let comp in dayMap[subject]){

          if(!counts[subject][comp]) counts[subject][comp] = 0;

          counts[subject][comp] += dayMap[subject][comp];
        }
      }
    }

    current.setDate(current.getDate() + 1);
  }

  return counts;
}

function applyManualReductions(totals){

  if(totals.ds?.S) totals.ds.S -= 4;
  if(totals.iot?.L) totals.iot.L -= 2;
  if(totals.iot?.P) totals.iot.P -= 2;
  if(totals.la?.T) totals.la.T -= 2;

  return totals;
}

function runEngine(){

  let subject = document.getElementById("subject").value;
  let selectedDate = new Date(document.getElementById("selectedDate").value);

  if(!selectedDate) return;

  if(selectedDate < semesterStart){
    document.getElementById("output").innerText = "Semester not started.";
    return;
  }

  if(selectedDate > semesterEnd){
    selectedDate = new Date(semesterEnd);
  }

  let completed = countClasses(selectedDate);
  let totalSemester = countClasses(semesterEnd);
  totalSemester = applyManualReductions(totalSemester);

  let result = "Completed till date:\n";
  result += JSON.stringify(completed[subject] || {}, null, 2);
  result += "\n\nTotal Semester:\n";
  result += JSON.stringify(totalSemester[subject] || {}, null, 2);

  document.getElementById("output").innerText = result;
}

</script>

</body>
</html>
