<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bunk calculator</title>

<style>
*{
  box-sizing:border-box;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",sans-serif;
}

body{
  margin:0;
  height:100vh;
  overflow:hidden;
  color:white;
}

/* ===== VIDEO BACKGROUND ===== */
video{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%) scale(1.15);
  min-width:100%;
  min-height:100%;
  object-fit:cover;
  z-index:-3;
  filter:brightness(0.6) contrast(1.1) saturate(1.2);
}

/* Ambient dark layer */
.overlay{
  position:fixed;
  inset:0;
  background:linear-gradient(
    135deg,
    rgba(0,0,0,0.55),
    rgba(10,10,20,0.7)
  );
  z-index:-2;
}

/* ===== GLASS CARD ===== */
.card{
  position:relative;
  width:95%;
  max-width:540px;
  margin:auto;
  top:50%;
  transform:translateY(-50%);
  padding:32px;
  border-radius:30px;

  backdrop-filter:blur(35px) saturate(140%);
  -webkit-backdrop-filter:blur(35px) saturate(140%);

  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.25);

  box-shadow:
    0 40px 100px rgba(0,0,0,0.6),
    inset 0 1px 0 rgba(255,255,255,0.3);
}

/* Headings */
h1{
  margin:0;
  text-align:center;
  font-weight:600;
}

.subtitle{
  text-align:center;
  opacity:0.7;
  margin-bottom:20px;
}

/* Inputs */
select,input{
  width:100%;
  padding:14px;
  margin-bottom:14px;
  border-radius:18px;
  border:none;
  background:rgba(255,255,255,0.12);
  color:white;
  outline:none;
}

/* Button */
button{
  width:100%;
  padding:16px;
  border-radius:22px;
  border:none;
  background:rgba(255,255,255,0.18);
  color:white;
  font-weight:600;
  cursor:pointer;
  backdrop-filter:blur(10px);
  transition:0.2s;
}

button:hover{
  background:rgba(255,255,255,0.28);
}

/* Progress Ring */
.progress{
  margin:25px auto 15px;
  width:150px;
  height:150px;
  position:relative;
}

svg{
  transform:rotate(-90deg);
}

circle{
  fill:none;
  stroke-width:12;
  stroke-linecap:round;
}

.bg{
  stroke:rgba(255,255,255,0.15);
}

.fg{
  stroke:white;
  stroke-dasharray:440;
  stroke-dashoffset:440;
  transition:stroke-dashoffset 1s ease;
}

.percent-text{
  position:absolute;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:26px;
  font-weight:600;
}

/* Component Stats */
.components{
  margin-top:8px;
  font-size:14px;
  opacity:0.9;
  text-align:right;
  line-height:1.6;
}
</style>
</head>

<body>

<video autoplay muted loop>
  <source src="bg.mp4" type="video/mp4">
</video>

<div class="overlay"></div>

<div class="card">

<h1>Rand Ravi ðŸ‘‹</h1>
<div class="subtitle">College Odhu Bunk mudhu </div>

<select id="subject" onchange="loadComponents()">
  <option value="">Select Subject</option>
  <option value="ds">Data Structures</option>
  <option value="python">Python</option>
  <option value="la">Linear Algebra</option>
  <option value="dtw">Design Tools</option>
  <option value="coa">COA</option>
  <option value="iot">IoT</option>
  <option value="comm">Communication</option>
</select>

<input type="date" id="selectedDate">

<div id="componentInputs"></div>

<button onclick="calculate()">Calculate</button>

<div class="progress">
<svg width="150" height="150">
  <circle class="bg" cx="75" cy="75" r="70"/>
  <circle class="fg" cx="75" cy="75" r="70"/>
</svg>
<div class="percent-text" id="percentText">0%</div>
</div>

<div class="components" id="componentStats"></div>

</div>

<script>

/* ===== Engine ===== */

const semesterStart = new Date("2025-12-22");
const semesterEnd = new Date("2026-04-18");

const holidays = [
  "2026-01-12","2026-01-13","2026-01-14",
  "2026-01-15","2026-01-16","2026-01-17",
  "2026-03-19","2026-03-21",
  "2026-03-27","2026-04-14"
];

function isHoliday(date){
  return holidays.includes(date.toISOString().split("T")[0]);
}

function isExamWeek(date){
  let start = new Date("2026-02-16");
  let end = new Date("2026-02-21");
  return date >= start && date <= end;
}

function getPeriods(day){
  switch(day){
    case 1: return [
      {sub:"ds",comp:"S"},
      {sub:"ds",comp:"S"},
      {sub:"python",comp:"L"},
      {sub:"python",comp:"L"},
      {sub:"comm",comp:"P"},
      {sub:"comm",comp:"P"}
    ];
    case 2: return [
      {sub:"ds",comp:"S"},
      {sub:"ds",comp:"S"},
      null,null,
      {sub:"comm",comp:"P"},
      {sub:"comm",comp:"P"}
    ];
    case 3: return [
      {sub:"iot",comp:"L"},
      {sub:"iot",comp:"L"},
      {sub:"ds",comp:"L"},
      {sub:"ds",comp:"L"},
      {sub:"dtw",comp:"P"},
      {sub:"dtw",comp:"P"}
    ];
    case 4: return [
      {sub:"iot",comp:"P"},
      {sub:"iot",comp:"P"},
      {sub:"la",comp:"S"},
      {sub:"la",comp:"S"},
      {sub:"dtw",comp:"P"},
      {sub:"dtw",comp:"P"}
    ];
    case 5: return [
      {sub:"la",comp:"T"},
      {sub:"la",comp:"T"},
      {sub:"ds",comp:"P"},
      {sub:"ds",comp:"P"},
      {sub:"coa",comp:"L"},
      {sub:"coa",comp:"L"}
    ];
    case 6: return [
      {sub:"coa",comp:"L"},
      null,
      {sub:"python",comp:"P"},
      {sub:"python",comp:"P"},
      {sub:"ds",comp:"L"},
      null
    ];
    default: return [];
  }
}

function countClasses(untilDate){
  let counts = {};
  let current = new Date(semesterStart);

  while(current < untilDate){
    if(current.getDay() !== 0 && !isHoliday(current)){
      let periods = getPeriods(current.getDay());
      if(isExamWeek(current)) periods = periods.slice(2);

      periods.forEach(p=>{
        if(!p) return;
        if(!counts[p.sub]) counts[p.sub]={};
        if(!counts[p.sub][p.comp]) counts[p.sub][p.comp]=0;
        counts[p.sub][p.comp]++;
      });
    }
    current.setDate(current.getDate()+1);
  }
  return counts;
}

const subjectComponents = {
  ds:["L","P","S"],
  python:["L","P"],
  la:["T","S"],
  dtw:["P"],
  coa:["L"],
  iot:["L","P"],
  comm:["P"]
};

function loadComponents(){
  let subject=document.getElementById("subject").value;
  let container=document.getElementById("componentInputs");
  container.innerHTML="";
  if(!subject) return;

  subjectComponents[subject].forEach(c=>{
    container.innerHTML+=
      `<input type="number" id="${c}" placeholder="${c} Attended">`;
  });
}

function calculate(){

  let subject=document.getElementById("subject").value;
  let dateValue=document.getElementById("selectedDate").value;

  if(!subject||!dateValue) return;

  let selectedDate=new Date(dateValue);
  if(selectedDate>semesterEnd) selectedDate=semesterEnd;

  let completed=countClasses(selectedDate);
  let totals=countClasses(semesterEnd);

  let compCompleted=completed[subject]||{};
  let compTotal=totals[subject]||{};

  // ===== REMOVE 3 FROM EACH COMPONENT =====
  Object.keys(compTotal).forEach(c=>{
    compTotal[c]=Math.max(0,compTotal[c]-3);
  });

  // ===== REMOVE MARCH 6 & 7 =====
  let festDates=["2026-03-06","2026-03-07"];
  festDates.forEach(dateStr=>{
    let festCount=countClasses(new Date(dateStr));
    let beforeFest=countClasses(new Date(new Date(dateStr).getTime()-86400000));
    let diff={};

    Object.keys(festCount).forEach(sub=>{
      if(!beforeFest[sub]) return;
      Object.keys(festCount[sub]).forEach(c=>{
        let removed=festCount[sub][c]-(beforeFest[sub][c]||0);
        if(sub===subject && removed>0){
          compTotal[c]=Math.max(0,compTotal[c]-removed);
        }
      });
    });
  });

  // ===== WEIGHTS =====
  const weights={L:1,T:0.25,P:0.5,S:0.25};

  let weightedTotal=0;
  Object.keys(compTotal).forEach(c=>{
    weightedTotal+= (compTotal[c]||0)*weights[c];
  });

  let requiredWeighted=0.85*weightedTotal;
  let maxWeightedLoss=weightedTotal-requiredWeighted;

  let stats="";
  let totalAttended=0,totalCompleted=0;

  subjectComponents[subject].forEach(c=>{

    let input=document.getElementById(c);
    let compComp=compCompleted[c]||0;
    let compTot=compTotal[c]||0;

    if(input && input.value){

      let attended=parseInt(input.value)||0;

      totalAttended+=attended;
      totalCompleted+=compComp;

      let percent=compComp?(attended/compComp)*100:0;

      // Max bunk for THIS component
      let bunk=Math.floor(maxWeightedLoss/weights[c]);

      if(bunk>compTot) bunk=compTot;
      if(bunk<0) bunk=0;

      stats+=`
        <div>
          <b>${c}</b>: ${percent.toFixed(1)}% 
          (${attended}/${compComp})<br>
          Max Safe Bunks: ${bunk}
        </div><br>
      `;

    }else{
      stats+=`
        <div>
          <b>${c}</b>: 
          <span style="opacity:0.6">
          Enter attendance
          </span>
        </div><br>
      `;
    }
  });

  let combined=totalCompleted?(totalAttended/totalCompleted)*100:0;

  animateProgress(combined);
  document.getElementById("componentStats").innerHTML=stats;
}

function animateProgress(percent){
  let circle=document.querySelector(".fg");
  let text=document.getElementById("percentText");

  let offset=440-(440*(percent/100));
  circle.style.strokeDashoffset=offset;
  text.innerText=percent.toFixed(1)+"%";
}

</script>

</body>
</html>
